Алгоритм rsync:

Beta разбивает файл B на блоки длиной L (последний блок может быть меньше L байт) и вычисляет две сигнатуры Rb и Sb для каждого блока, после чего пересылает эти сигнатуры к Alpha .
Alpha вычисляет сигнатуры Ra для блоков длинной L , для каждого байтового смещения. После чего сравнивает их с Rb .
Для блоков, чьи R сигнатуры совпали, Alpha вычисляет Sa и сравнивает с Sb .
Если S сигнатуры совпадают, Alpha отсылает уведомление с номером совпавшего блока, в противном случае Alpha пересылает один байт.
Beta получает номера совпавших блоков из B или одиночные байты из файла A и на основе этих данных создаёт копию файла A .
Важно понимать, что ключом алгоритма является создание двух сигнатур - быстрой и стойкой. Быстрая ( R ) используется как фильтр (на компьютере Alpha она вычисляется для каждого байтового смещения!). Стойкая ( S ) используется для более точной проверки.

Стойкая сигнатура
Стойкая сигнатура может не быть быстрой, так как вычисляется только при совпадении простой, быстрой сигнатуры. Главным свойством стойкой сигнатуры должна быть минимальная вероятность отказа, иначе говоря, наличия одной и той же сигнатуры для двух разных блоков.

Быстрая сигнатура
Быстрая сигнатура очень важна для эффективности алгоритма rsync. Она работает как фильтр, предотвращая вычисление стойкой сигнатуры. Основная задача быстрой сигнатуры - это максимально быстрое её вычисление для каждого байтового смещения в файле.

Первоначально, для создания быстрой сигнатуры в rsync было опробовано простое склеивание первых и последних 4 байт блока. Хотя такой алгоритм в принципе работал, но был выявлен его серьёзный недостаток. Для определённых типов данных, например для tar файла, он слишком часто создавал одинаковые сигнатуры для разных частей файла, что приводило к многократному вычислению стойкой сигнатуры и как следствие падению производительности всего алгоритма.

При совпадении блоков, Alpha отсылает Beta данные из файла A между текущим смещением и предыдущим совпадением, а также индекс совпавшего блока который есть в B . Эти данные отсылаются сразу же при нахождении совпадения.

Если совпадения найдено не было для текущего смещения в файле A , вычисляется быстрая сигнатура для следующего байтового смещения и процедура поиска повторяется. При совпадении, смещение увеличивается на размер совпавшего блока и поиск продолжается.

